<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Particle Flow</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      /* White â†’ very light blue vertical gradient */
      background: white;
    }
    canvas {
      display: block;
    }
  </style>
  <!-- p5.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>
<body>
<script>
/*--------------------
Vars
--------------------*/
const deg = (a) => Math.PI / 180 * a
const rand = (v1, v2) => Math.floor(v1 + Math.random() * (v2 - v1))
const opt = {
  particles: 300,
  noiseScale: 0.003,
  // Angle pointing mostly downward
  angle: Math.PI / 180,
  // Blue / aqua palette
  h1: 185, // aqua-ish
  h2: 225, // blue-ish
  s1: 80,
  s2: 90,
  l1: 45,
  l2: 55,
  speed: 0.5,
  strokeWeight: 5,
  tail: 0.98,
}
const Particles = []
let time = 0

/*--------------------
Particle
--------------------*/
class Particle {
  constructor(x, y) {
    this.x = x
    this.y = y
    this.lx = x
    this.ly = y
    this.vx = 0
    this.vy = 0
    this.ax = 0
    this.ay = 0
    this.speed = opt.speed
    this.hueRand = Math.random()
    this.hue = this.hueRand > .5 ? 20 + opt.h1 : 20 + opt.h2
    this.sat = this.hueRand > .5 ? opt.s1 : opt.s2
    this.light = this.hueRand > .5 ? opt.l1 : opt.l2
    this.maxSpeed = this.hueRand > .5 ? 3 : 2
  }

  update() {
    this.follow()

    this.vx += this.ax
    this.vy += this.ay

    let p = Math.sqrt(this.vx * this.vx + this.vy * this.vy)
    let a = Math.atan2(this.vy, this.vx)
    let m = Math.min(this.maxSpeed, p) * this.speed
    this.vx = Math.cos(a) * m
    this.vy = Math.sin(a) * m

    this.x += this.vx
    this.y += this.vy
    this.ax = 0
    this.ay = 0

    this.edges()
  }

  follow() {
    let angle =
      noise(this.x * opt.noiseScale, this.y * opt.noiseScale, time * opt.noiseScale) *
        Math.PI *
        0.5 +
      opt.angle
    this.ax += Math.cos(angle)
    this.ay += Math.sin(angle)
  }

  updatePrev() {
    this.lx = this.x
    this.ly = this.y
  }

  edges() {
    if (this.x < 0) {
      this.x = width
      this.updatePrev()
    }
    if (this.x > width) {
      this.x = 0
      this.updatePrev()
    }
    if (this.y < 0) {
      this.y = height
      this.updatePrev()
    }
    if (this.y > height) {
      this.y = 0
      this.updatePrev()
    }
  }

  render() {
    stroke(`hsla(${this.hue}, ${this.sat}%, ${this.light}%, 1)`)
    line(this.x, this.y, this.lx, this.ly)
    this.updatePrev()
  }
}

/*--------------------
Setup
--------------------*/
function setup() {
  // Transparent canvas so the body gradient shows through
  createCanvas(530, windowHeight)
  clear()
  for (let i = 0; i < opt.particles; i++) {
    Particles.push(new Particle(Math.random() * width, Math.random() * height))
  }
  strokeWeight(opt.strokeWeight)
}

/*--------------------
Draw
--------------------*/
function draw() {
  time++
  // Redraw a translucent white over the canvas to create a faint motion trail
  // while letting the page's gradient remain visible.
  background(255, 255, 255, 255 * (1 - opt.tail))
// 230, 230, 244
  for (let p of Particles) {
    p.update()
    p.render()
  }
}

</script>
</body>
</html>
